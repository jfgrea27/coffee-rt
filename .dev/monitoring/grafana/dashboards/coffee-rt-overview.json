{
  "title": "Coffee RT Overview",
  "uid": "coffee-rt-overview",
  "schemaVersion": 39,
  "panels": [
    {
      "id": 1,
      "title": "HTTP Request Rate",
      "type": "timeseries",
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 0},
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "sum(rate(http_requests_total[5m])) by (endpoint, method)",
          "legendFormat": "{{method}} {{endpoint}}",
          "refId": "A"
        }
      ],
      "fieldConfig": {"defaults": {"unit": "reqps"}}
    },
    {
      "id": 2,
      "title": "HTTP Response Time (p95)",
      "type": "timeseries",
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 0},
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "histogram_quantile(0.95, sum(rate(http_request_duration_seconds_bucket[5m])) by (le, endpoint))",
          "legendFormat": "{{endpoint}}",
          "refId": "A"
        }
      ],
      "fieldConfig": {"defaults": {"unit": "s"}}
    },
    {
      "id": 3,
      "title": "Orders per Minute",
      "type": "timeseries",
      "gridPos": {"h": 6, "w": 12, "x": 0, "y": 8},
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "sum(rate(orders_created_total[5m])) by (drink) * 60",
          "legendFormat": "{{drink}}",
          "refId": "A"
        }
      ],
      "fieldConfig": {"defaults": {"unit": "short"}}
    },
    {
      "id": 4,
      "title": "Revenue per Minute ($)",
      "type": "timeseries",
      "gridPos": {"h": 6, "w": 12, "x": 12, "y": 8},
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "sum(rate(order_value_total[5m])) by (store) * 60",
          "legendFormat": "{{store}}",
          "refId": "A"
        }
      ],
      "fieldConfig": {"defaults": {"unit": "currencyUSD"}}
    },
    {
      "id": 5,
      "title": "Total Orders Created",
      "type": "stat",
      "gridPos": {"h": 4, "w": 6, "x": 0, "y": 14},
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "sum(orders_created_total) or vector(0)",
          "legendFormat": "Orders",
          "refId": "A"
        }
      ]
    },
    {
      "id": 6,
      "title": "Total Revenue",
      "type": "stat",
      "gridPos": {"h": 4, "w": 6, "x": 6, "y": 14},
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "sum(order_value_total) or vector(0)",
          "legendFormat": "Revenue",
          "refId": "A"
        }
      ],
      "fieldConfig": {"defaults": {"unit": "currencyUSD"}}
    },
    {
      "id": 7,
      "title": "Orders by Version",
      "type": "piechart",
      "gridPos": {"h": 4, "w": 6, "x": 12, "y": 14},
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "sum(orders_created_total) by (version)",
          "legendFormat": "{{version}}",
          "refId": "A"
        }
      ]
    },
    {
      "id": 8,
      "title": "Orders by Store",
      "type": "piechart",
      "gridPos": {"h": 4, "w": 6, "x": 18, "y": 14},
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "sum(orders_created_total) by (store)",
          "legendFormat": "{{store}}",
          "refId": "A"
        }
      ]
    },
    {
      "id": 13,
      "title": "Container CPU Usage",
      "type": "timeseries",
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 18},
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "sum(rate(container_cpu_usage_seconds_total{name=~\".+\"}[1m])) by (name) * 100",
          "legendFormat": "{{name}}",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "min": 0
        }
      },
      "options": {
        "legend": {"displayMode": "table", "placement": "right"}
      }
    },
    {
      "id": 14,
      "title": "Container Memory Usage",
      "type": "timeseries",
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 18},
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "container_memory_usage_bytes{name=~\".+\"} / 1024 / 1024",
          "legendFormat": "{{name}}",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "decmbytes",
          "min": 0
        }
      },
      "options": {
        "legend": {"displayMode": "table", "placement": "right"}
      }
    },
    {
      "id": 9,
      "title": "API Logs",
      "type": "logs",
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 26},
      "datasource": "Loki",
      "targets": [
        {
          "expr": "{job=\"coffee-rt\", filename=\"/var/log/apps/api.log\"}",
          "refId": "A"
        }
      ],
      "options": {
        "showTime": true,
        "showLabels": false,
        "showCommonLabels": false,
        "wrapLogMessage": true,
        "prettifyLogMessage": true,
        "enableLogDetails": true,
        "sortOrder": "Descending"
      }
    },
    {
      "id": 10,
      "title": "Aggregator Logs",
      "type": "logs",
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 26},
      "datasource": "Loki",
      "targets": [
        {
          "expr": "{job=\"coffee-rt\", filename=\"/var/log/apps/aggregator.log\"}",
          "refId": "A"
        }
      ],
      "options": {
        "showTime": true,
        "showLabels": false,
        "showCommonLabels": false,
        "wrapLogMessage": true,
        "prettifyLogMessage": true,
        "enableLogDetails": true,
        "sortOrder": "Descending"
      }
    },
    {
      "id": 11,
      "title": "Stream Worker Logs",
      "type": "logs",
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 34},
      "datasource": "Loki",
      "targets": [
        {
          "expr": "{job=\"coffee-rt\", filename=\"/var/log/apps/stream-worker.log\"}",
          "refId": "A"
        }
      ],
      "options": {
        "showTime": true,
        "showLabels": false,
        "showCommonLabels": false,
        "wrapLogMessage": true,
        "prettifyLogMessage": true,
        "enableLogDetails": true,
        "sortOrder": "Descending"
      }
    },
    {
      "id": 12,
      "title": "All Logs (Errors Only)",
      "type": "logs",
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 34},
      "datasource": "Loki",
      "targets": [
        {
          "expr": "{job=\"coffee-rt\", level=\"ERROR\"}",
          "refId": "A"
        }
      ],
      "options": {
        "showTime": true,
        "showLabels": true,
        "showCommonLabels": false,
        "wrapLogMessage": true,
        "prettifyLogMessage": true,
        "enableLogDetails": true,
        "sortOrder": "Descending"
      }
    }
  ]
}
